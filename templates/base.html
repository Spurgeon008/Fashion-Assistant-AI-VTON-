{% load static %}

<!DOCTYPE HTML>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="pragma" content="no-cache" />
<meta http-equiv="cache-control" content="max-age=604800" />
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<title>GreatKart | One of the Biggest Online Shopping Platform</title>

<link href="{% static 'images/favicon.ico' %}" rel="shortcut icon" type="image/x-icon">

<!-- jQuery -->
<script src="{% static 'js/jquery-2.0.0.min.js' %}" type="text/javascript"></script>

<!-- Bootstrap4 files-->
<script src="{% static 'js/bootstrap.bundle.min.js' %}" type="text/javascript"></script>
<link href="{% static 'css/bootstrap.css' %}" rel="stylesheet" type="text/css"/>

<!-- Font awesome 5 -->
<link href="{% static 'fonts/fontawesome/css/all.min.css' %}" type="text/css" rel="stylesheet">

<!-- custom style -->
<link href="{% static 'css/ui.css' %}" rel="stylesheet" type="text/css"/>
<link href="{% static 'css/responsive.css' %}" rel="stylesheet" media="only screen and (max-width: 1200px)" />

<!-- custom javascript -->
<script src="{% static 'js/script.js' %}" type="text/javascript"></script>

<script type="text/javascript">
/// some script

// jquery ready start
$(document).ready(function() {
	// jQuery code

}); 
// jquery end
</script>

</head>
<body>

 
{% include 'includes/navbar.html' %}

{% block content %}

{% endblock %}

{% include 'includes/footer.html' %}

<!-- Virtual Try-On JavaScript -->
<script>
$(document).ready(function() {
    // Handle Image VTon form submission
    $('#image-vton-form').on('submit', function(e) {
        e.preventDefault();
        
        // Get the form data
        var formData = new FormData();
        var personImage = $('#person-image')[0].files[0];
        var clothImage = $('#cloth-image')[0].files[0];
        
        // Validate that both images are provided
        if (!personImage || !clothImage) {
            alert('Please select both person and cloth images.');
            return;
        }
        
        // Add images to form data
        formData.append('person_image', personImage);
        formData.append('cloth_image', clothImage);
        
        // Show loading state
        var submitButton = $(this).find('button[type="submit"]');
        var originalText = submitButton.text();
        submitButton.text('Processing...').prop('disabled', true);
        
        // Send request to backend
        $.ajax({
            url: '/vton/generate_vton/',
            type: 'POST',
            data: formData,
            processData: false,
            contentType: false,
            timeout: 60000, // 60 second timeout
            success: function(response) {
                console.log('VTON Response:', response);
                if (response.success) {
                    if (response.image_data) {
                        // Display the generated image
                        $('#image-vton-result').show();
                        $('#image-vton-output').attr('src', 'data:image/jpeg;base64,' + response.image_data);
                    } else if (response.text_response) {
                        // Display text response
                        $('#image-vton-result').show();
                        $('#image-vton-output').attr('src', 'https://via.placeholder.com/400x400/cccccc/ffffff?text=' + encodeURIComponent(response.text_response));
                    } else {
                        alert('Success but no data returned. Check console for details.');
                        console.log('Full response:', response);
                    }
                } else {
                    alert('Error: ' + (response.error || 'Unknown error occurred'));
                    console.error('VTON Error:', response);
                }
            },
            error: function(xhr, status, error) {
                console.error('AJAX Error:', xhr, status, error);
                var errorMessage = 'Error generating VTON image: ';
                
                if (xhr.responseJSON && xhr.responseJSON.error) {
                    errorMessage += xhr.responseJSON.error;
                } else if (xhr.responseText) {
                    try {
                        var errorResponse = JSON.parse(xhr.responseText);
                        errorMessage += errorResponse.error || xhr.responseText;
                    } catch (e) {
                        errorMessage += xhr.responseText;
                    }
                } else {
                    errorMessage += error || 'Unknown error occurred';
                }
                
                alert(errorMessage);
            },
            complete: function() {
                // Restore button state
                submitButton.text(originalText).prop('disabled', false);
            }
        });
    });
    
    // Handle Video VTon form submission
    $('#video-vton-form').on('submit', function(e) {
        e.preventDefault();
        // In a real implementation, you would send the file to your backend
        // For now, we'll just show a placeholder result
        $('#video-vton-result').show();
        $('#video-vton-output').attr('src', 'https://sample-videos.com/zip/10/mp4/Sample-Video-10mb.mp4');
    });
});
</script>