{% extends 'base.html' %}

{% load static %}

{% block content %}

<section class="section-content padding-y bg">
    <div class="container">
    
    <!-- ============================ COMPONENT 1 ================================= -->
    <div class="card">
        <div class="row no-gutters">
            <aside class="col-md-6">
    <article class="gallery-wrap"> 
        <div class="img-big-wrap">
           <a href="#"><img src="{{ single_product.images.url }}" class="img-fluid"></a>
        </div> <!-- img-big-wrap.// -->
        
    </article> <!-- gallery-wrap .end// -->
            </aside>
            <main class="col-md-6 border-left">
              <form action="{% url 'add_cart' single_product.id %}" method="POST">
              {% csrf_token %}
              <article class="content-body">
    
                <h2 class="title">{{ single_product.product_name }}</h2>
                
                <!-- Rating -->
                <div class="rating-stars mb-3">
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="far fa-star"></i>
                    <span class="text-muted ml-2">(4.0) | 128 reviews</span>
                </div>
                
                <!-- Price -->
                <div class="mb-3"> 
                    <var class="price h3">${{ single_product.price }}</var>
                    <span class="text-muted ml-2"><del>$99.99</del></span>
                    <span class="badge badge-success ml-2">20% OFF</span>
                </div>
                
                <!-- Stock Status -->
                <div class="mb-3">
                    {% if single_product.stock > 10 %}
                        <span class="stock-indicator in-stock">
                            <i class="fas fa-check-circle mr-1"></i> In Stock
                        </span>
                    {% elif single_product.stock > 0 %}
                        <span class="stock-indicator low-stock">
                            <i class="fas fa-exclamation-circle mr-1"></i> Only {{ single_product.stock }} left!
                        </span>
                    {% else %}
                        <span class="stock-indicator out-of-stock">
                            <i class="fas fa-times-circle mr-1"></i> Out of Stock
                        </span>
                    {% endif %}
                </div>
                
                <!-- Description -->
                <p class="text-muted">{{single_product.description}}</p>
                
                <hr>
                
                <!-- Color Selection -->
                {% if variations.color %}
                <div class="row">
                    <div class="item-option-select">
                        <h6><i class="fas fa-palette mr-2"></i>Choose Color</h6>
                        <select name="color" id="color" class="form-control" required>
                            <option value="" disabled selected>Select a color</option>
                            {% for variation in variations.color %}
                                <option value="{{ variation.variation_value | lower }}">{{ variation.variation_value | capfirst }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                {% endif %}
                
                <!-- Size Selection -->
                {% if variations.size %}
                <div class="row mt-3">
                    <div class="item-option-select">
                        <h6><i class="fas fa-ruler mr-2"></i>Select Size</h6>
                        <select name="size" id="size" class="form-control" required>
                            <option value="" disabled selected>Select a size</option>
                            {% for variation in variations.size %}
                                <option value="{{ variation.variation_value | lower }}">{{ variation.variation_value | upper }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                {% endif %}
                
                <hr>
                
                <!-- Action Buttons -->
                <div class="d-flex gap-2">
                    {% if single_product.stock > 0 %}
                        <button type="submit" class="btn btn-primary btn-lg flex-grow-1">
                            <i class="fas fa-shopping-cart mr-2"></i> Add to Cart
                        </button>
                        <button type="button" class="btn btn-outline-danger btn-lg wishlist-btn-detail">
                            <i class="far fa-heart"></i>
                        </button>
                    {% else %}
                        <button type="button" class="btn btn-secondary btn-lg disabled flex-grow-1">
                            <i class="fas fa-times mr-2"></i> Out of Stock
                        </button>
                    {% endif %}
                </div>
                
                <!-- Add to Wardrobe Button -->
                {% if user.is_authenticated and single_product.stock > 0 %}
                <div class="mt-3">
                    <button type="button" class="btn btn-outline-success btn-block" data-toggle="modal" data-target="#wardrobeModal">
                        <i class="fas fa-tshirt mr-2"></i> Add to My Wardrobe
                    </button>
                </div>
                {% endif %}
                
                <!-- Product Features -->
                <div class="mt-4">
                    <ul class="list-unstyled">
                        <li class="mb-2">
                            <i class="fas fa-shipping-fast text-primary mr-2"></i>
                            <span class="text-muted">Free shipping on orders over $50</span>
                        </li>
                        <li class="mb-2">
                            <i class="fas fa-undo text-primary mr-2"></i>
                            <span class="text-muted">30-day easy returns</span>
                        </li>
                        <li class="mb-2">
                            <i class="fas fa-shield-alt text-primary mr-2"></i>
                            <span class="text-muted">1-year warranty</span>
                        </li>
                    </ul>
                </div>
                
            </article>
            </form>
            </main>
        </div> <!-- row.// -->
    </div> <!-- card.// -->
    <!-- ============================ COMPONENT 1 END .// ================================= -->
    
    <br>
    
    <!-- ============================ VIRTUAL TRY-ON SECTION ================================= -->
    <div class="card">
        <div class="card-header">
            <h4>Virtual Try-On</h4>
        </div>
        <div class="card-body">
            <!-- VTon Tabs -->
            <ul class="nav nav-tabs" id="vtonTabs" role="tablist">
                <li class="nav-item">
                    <a class="nav-link active" id="image-vton-tab" data-toggle="tab" href="#image-vton" role="tab">Image Gen VTon</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="video-vton-tab" data-toggle="tab" href="#video-vton" role="tab">Video Gen VTon</a>
                </li>
            </ul>
            
            <!-- VTon Tab Content -->
            <div class="tab-content" id="vtonTabsContent">
                <!-- Image Gen VTon Tab -->
                <div class="tab-pane fade show active" id="image-vton" role="tabpanel">
                    <div class="mt-3">
                        <h5>Upload Images for Image-based Virtual Try-On</h5>
                        <form id="image-vton-form">
                            <div class="form-group">
                                <label for="person-image">Person Image:</label>
                                <input type="file" class="form-control-file" id="person-image" accept="image/*" required>
                            </div>
                            <div class="form-group">
                                <label for="cloth-image">Cloth Image:</label>
                                <input type="file" class="form-control-file" id="cloth-image" accept="image/*" required>
                            </div>
                            <button type="submit" class="btn btn-primary">Generate Try-On (Image)</button>
                        </form>
                        <div id="image-vton-result" class="mt-3" style="display: none;">
                            <h5>Result:</h5>
                            <img id="image-vton-output" src="" alt="VTon Result" class="img-fluid" style="max-width: 100%; border: 1px solid #ddd; border-radius: 4px; padding: 5px;">
                            <div class="mt-2">
                                <button id="download-vton-btn" class="btn btn-success">
                                    <i class="fas fa-download"></i> Download Image
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Video Gen VTon Tab -->
                <div class="tab-pane fade" id="video-vton" role="tabpanel">
                    <div class="mt-3">
                        <h5>Upload Image for Video-based Virtual Try-On</h5>
                        <form id="video-vton-form">
                            <div class="form-group">
                                <label for="video-person-image">Person Image:</label>
                                <input type="file" class="form-control-file" id="video-person-image" accept="image/*" required>
                            </div>
                            <button type="submit" class="btn btn-primary">Generate Try-On (Video)</button>
                        </form>
                        <div id="video-vton-result" class="mt-3" style="display: none;">
                            <h5>Result:</h5>
                            <video id="video-vton-output" src="" controls class="img-fluid"></video>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- ============================ VIRTUAL TRY-ON SECTION END ================================= -->

    <br>
    
    <!-- ============================ REVIEWS SECTION ================================= -->
    <div class="card">
        <div class="card-header bg-light">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <h4 class="mb-0">
                        <i class="fas fa-comments mr-2 text-primary"></i> Customer Reviews
                    </h4>
                </div>
                <div class="col-md-6 text-md-right">
                    <button class="btn btn-primary btn-sm" data-toggle="modal" data-target="#reviewModal">
                        <i class="fas fa-pen mr-1"></i> Write a Review
                    </button>
                </div>
            </div>
        </div>
        
        <div class="card-body">
            <!-- Overall Rating Summary -->
            <div class="row mb-4 pb-4 border-bottom">
                <div class="col-md-4 text-center">
                    <div class="rating-summary">
                        <h1 class="display-3 font-weight-bold text-primary mb-0">4.0</h1>
                        <div class="rating-stars mb-2">
                            <i class="fas fa-star text-warning"></i>
                            <i class="fas fa-star text-warning"></i>
                            <i class="fas fa-star text-warning"></i>
                            <i class="fas fa-star text-warning"></i>
                            <i class="far fa-star text-warning"></i>
                        </div>
                        <p class="text-muted mb-0">Based on 128 reviews</p>
                    </div>
                </div>
                <div class="col-md-8">
                    <div class="rating-breakdown">
                        <!-- 5 Stars -->
                        <div class="d-flex align-items-center mb-2">
                            <span class="rating-label">5 <i class="fas fa-star text-warning"></i></span>
                            <div class="progress flex-grow-1 mx-3">
                                <div class="progress-bar bg-success" role="progressbar" style="width: 65%" aria-valuenow="65" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                            <span class="rating-count">83</span>
                        </div>
                        <!-- 4 Stars -->
                        <div class="d-flex align-items-center mb-2">
                            <span class="rating-label">4 <i class="fas fa-star text-warning"></i></span>
                            <div class="progress flex-grow-1 mx-3">
                                <div class="progress-bar bg-info" role="progressbar" style="width: 20%" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                            <span class="rating-count">26</span>
                        </div>
                        <!-- 3 Stars -->
                        <div class="d-flex align-items-center mb-2">
                            <span class="rating-label">3 <i class="fas fa-star text-warning"></i></span>
                            <div class="progress flex-grow-1 mx-3">
                                <div class="progress-bar bg-warning" role="progressbar" style="width: 10%" aria-valuenow="10" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                            <span class="rating-count">13</span>
                        </div>
                        <!-- 2 Stars -->
                        <div class="d-flex align-items-center mb-2">
                            <span class="rating-label">2 <i class="fas fa-star text-warning"></i></span>
                            <div class="progress flex-grow-1 mx-3">
                                <div class="progress-bar bg-orange" role="progressbar" style="width: 3%" aria-valuenow="3" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                            <span class="rating-count">4</span>
                        </div>
                        <!-- 1 Star -->
                        <div class="d-flex align-items-center mb-2">
                            <span class="rating-label">1 <i class="fas fa-star text-warning"></i></span>
                            <div class="progress flex-grow-1 mx-3">
                                <div class="progress-bar bg-danger" role="progressbar" style="width: 2%" aria-valuenow="2" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                            <span class="rating-count">2</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Filter and Sort -->
            <div class="d-flex justify-content-between align-items-center mb-3">
                <div>
                    <button class="btn btn-sm btn-outline-secondary active" data-filter="all">
                        All Reviews (128)
                    </button>
                    <button class="btn btn-sm btn-outline-secondary" data-filter="verified">
                        <i class="fas fa-check-circle"></i> Verified (95)
                    </button>
                    <button class="btn btn-sm btn-outline-secondary" data-filter="images">
                        <i class="fas fa-image"></i> With Photos (42)
                    </button>
                </div>
                <div>
                    <select class="form-control form-control-sm" id="reviewSort">
                        <option value="recent">Most Recent</option>
                        <option value="helpful">Most Helpful</option>
                        <option value="highest">Highest Rating</option>
                        <option value="lowest">Lowest Rating</option>
                    </select>
                </div>
            </div>
            
            <!-- Individual Reviews -->
            <div id="reviewsList">
                <!-- Review 1 -->
                <article class="review-item mb-4 pb-4 border-bottom">
                    <div class="d-flex">
                        <div class="review-avatar mr-3">
                            <img src="{% static 'images/avatars/avatar1.jpg' %}" class="rounded-circle" width="50" height="50" alt="User">
                        </div>
                        <div class="review-content flex-grow-1">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <div>
                                    <h6 class="mb-0 font-weight-bold">Sarah Johnson</h6>
                                    <div class="rating-stars">
                                        <i class="fas fa-star text-warning"></i>
                                        <i class="fas fa-star text-warning"></i>
                                        <i class="fas fa-star text-warning"></i>
                                        <i class="fas fa-star text-warning"></i>
                                        <i class="fas fa-star text-warning"></i>
                                    </div>
                                </div>
                                <span class="text-muted small">2 days ago</span>
                            </div>
                            <div class="mb-2">
                                <span class="badge badge-success">
                                    <i class="fas fa-check-circle"></i> Verified Purchase
                                </span>
                            </div>
                            <h6 class="font-weight-bold">Excellent quality and fit!</h6>
                            <p class="text-muted mb-2">
                                This product exceeded my expectations! The quality is outstanding and it fits perfectly. 
                                I've been using it for a week now and I'm very satisfied. Highly recommend to anyone looking for quality.
                            </p>
                            <!-- Review Images -->
                            <div class="review-images mb-3">
                                <img src="{% static 'images/items/1.jpg' %}" class="review-img" alt="Review">
                                <img src="{% static 'images/items/2.jpg' %}" class="review-img" alt="Review">
                            </div>
                            <div class="review-actions">
                                <button class="btn btn-sm btn-outline-secondary helpful-btn">
                                    <i class="far fa-thumbs-up"></i> Helpful (24)
                                </button>
                                <button class="btn btn-sm btn-outline-secondary ml-2">
                                    <i class="far fa-comment"></i> Reply
                                </button>
                            </div>
                        </div>
                    </div>
                </article>
                
                <!-- Review 2 -->
                <article class="review-item mb-4 pb-4 border-bottom">
                    <div class="d-flex">
                        <div class="review-avatar mr-3">
                            <img src="{% static 'images/avatars/avatar1.jpg' %}" class="rounded-circle" width="50" height="50" alt="User">
                        </div>
                        <div class="review-content flex-grow-1">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <div>
                                    <h6 class="mb-0 font-weight-bold">Mike Anderson</h6>
                                    <div class="rating-stars">
                                        <i class="fas fa-star text-warning"></i>
                                        <i class="fas fa-star text-warning"></i>
                                        <i class="fas fa-star text-warning"></i>
                                        <i class="fas fa-star text-warning"></i>
                                        <i class="far fa-star text-warning"></i>
                                    </div>
                                </div>
                                <span class="text-muted small">1 week ago</span>
                            </div>
                            <div class="mb-2">
                                <span class="badge badge-success">
                                    <i class="fas fa-check-circle"></i> Verified Purchase
                                </span>
                            </div>
                            <h6 class="font-weight-bold">Great value for money</h6>
                            <p class="text-muted mb-2">
                                Good product overall. The quality is solid and it arrived quickly. 
                                Only minor issue is the sizing runs a bit small, so I'd recommend ordering one size up.
                            </p>
                            <div class="review-actions">
                                <button class="btn btn-sm btn-outline-secondary helpful-btn">
                                    <i class="far fa-thumbs-up"></i> Helpful (15)
                                </button>
                                <button class="btn btn-sm btn-outline-secondary ml-2">
                                    <i class="far fa-comment"></i> Reply
                                </button>
                            </div>
                        </div>
                    </div>
                </article>
                
                <!-- Review 3 -->
                <article class="review-item mb-4 pb-4 border-bottom">
                    <div class="d-flex">
                        <div class="review-avatar mr-3">
                            <img src="{% static 'images/avatars/avatar1.jpg' %}" class="rounded-circle" width="50" height="50" alt="User">
                        </div>
                        <div class="review-content flex-grow-1">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <div>
                                    <h6 class="mb-0 font-weight-bold">Emily Chen</h6>
                                    <div class="rating-stars">
                                        <i class="fas fa-star text-warning"></i>
                                        <i class="fas fa-star text-warning"></i>
                                        <i class="fas fa-star text-warning"></i>
                                        <i class="fas fa-star text-warning"></i>
                                        <i class="fas fa-star text-warning"></i>
                                    </div>
                                </div>
                                <span class="text-muted small">2 weeks ago</span>
                            </div>
                            <div class="mb-2">
                                <span class="badge badge-success">
                                    <i class="fas fa-check-circle"></i> Verified Purchase
                                </span>
                            </div>
                            <h6 class="font-weight-bold">Love it! Will buy again</h6>
                            <p class="text-muted mb-2">
                                Absolutely love this product! The quality is amazing and it looks exactly like the pictures. 
                                Fast shipping and great customer service. Already recommended to my friends!
                            </p>
                            <div class="review-actions">
                                <button class="btn btn-sm btn-outline-secondary helpful-btn">
                                    <i class="far fa-thumbs-up"></i> Helpful (31)
                                </button>
                                <button class="btn btn-sm btn-outline-secondary ml-2">
                                    <i class="far fa-comment"></i> Reply
                                </button>
                            </div>
                        </div>
                    </div>
                </article>
            </div>
            
            <!-- Load More Button -->
            <div class="text-center mt-4">
                <button class="btn btn-outline-primary" id="loadMoreReviews">
                    <i class="fas fa-chevron-down mr-2"></i> Load More Reviews
                </button>
            </div>
        </div>
    </div>
    <!-- ============================ REVIEWS SECTION END ================================= -->
    
    <!-- Review Modal -->
    <div class="modal fade" id="reviewModal" tabindex="-1" role="dialog" aria-labelledby="reviewModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="reviewModalLabel">
                        <i class="fas fa-pen mr-2"></i> Write Your Review
                    </h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="reviewForm">
                        <!-- Rating -->
                        <div class="form-group">
                            <label class="font-weight-bold">Your Rating *</label>
                            <div class="star-rating-input">
                                <i class="far fa-star" data-rating="1"></i>
                                <i class="far fa-star" data-rating="2"></i>
                                <i class="far fa-star" data-rating="3"></i>
                                <i class="far fa-star" data-rating="4"></i>
                                <i class="far fa-star" data-rating="5"></i>
                            </div>
                            <input type="hidden" id="ratingValue" name="rating" required>
                        </div>
                        
                        <!-- Review Title -->
                        <div class="form-group">
                            <label for="reviewTitle" class="font-weight-bold">Review Title *</label>
                            <input type="text" class="form-control" id="reviewTitle" placeholder="Sum up your experience" required>
                        </div>
                        
                        <!-- Review Text -->
                        <div class="form-group">
                            <label for="reviewText" class="font-weight-bold">Your Review *</label>
                            <textarea class="form-control" id="reviewText" rows="5" placeholder="Share your thoughts about this product..." required></textarea>
                            <small class="form-text text-muted">Minimum 50 characters</small>
                        </div>
                        
                        <!-- Name -->
                        <div class="form-group">
                            <label for="reviewerName" class="font-weight-bold">Your Name *</label>
                            <input type="text" class="form-control" id="reviewerName" placeholder="Enter your name" required>
                        </div>
                        
                        <!-- Email -->
                        <div class="form-group">
                            <label for="reviewerEmail" class="font-weight-bold">Your Email *</label>
                            <input type="email" class="form-control" id="reviewerEmail" placeholder="your@email.com" required>
                            <small class="form-text text-muted">Your email will not be published</small>
                        </div>
                        
                        <!-- Upload Images -->
                        <div class="form-group">
                            <label class="font-weight-bold">Add Photos (Optional)</label>
                            <div class="custom-file">
                                <input type="file" class="custom-file-input" id="reviewImages" multiple accept="image/*">
                                <label class="custom-file-label" for="reviewImages">Choose images...</label>
                            </div>
                            <small class="form-text text-muted">You can upload up to 5 images</small>
                        </div>
                        
                        <!-- Recommend -->
                        <div class="form-group">
                            <div class="custom-control custom-checkbox">
                                <input type="checkbox" class="custom-control-input" id="recommendProduct">
                                <label class="custom-control-label" for="recommendProduct">
                                    I would recommend this product to a friend
                                </label>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="submitReview">
                        <i class="fas fa-paper-plane mr-2"></i> Submit Review
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Add to Wardrobe Modal -->
    <div class="modal fade" id="wardrobeModal" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-tshirt mr-2"></i> Add to My Wardrobe
                    </h5>
                    <button type="button" class="close" data-dismiss="modal">
                        <span>&times;</span>
                    </button>
                </div>
                <form method="POST" action="{% url 'add_to_wardrobe' single_product.id %}">
                    {% csrf_token %}
                    <div class="modal-body">
                        <p class="text-muted">Add this item to your digital wardrobe to track your purchases and outfits.</p>
                        
                        {% if variations.color %}
                        <div class="form-group">
                            <label for="wardrobe-color">Color</label>
                            <select name="color" id="wardrobe-color" class="form-control">
                                <option value="">Select color</option>
                                {% for variation in variations.color %}
                                    <option value="{{ variation.variation_value | lower }}">{{ variation.variation_value | capfirst }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        {% endif %}
                        
                        {% if variations.size %}
                        <div class="form-group">
                            <label for="wardrobe-size">Size</label>
                            <select name="size" id="wardrobe-size" class="form-control">
                                <option value="">Select size</option>
                                {% for variation in variations.size %}
                                    <option value="{{ variation.variation_value | lower }}">{{ variation.variation_value | upper }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        {% endif %}
                        
                        <div class="form-group">
                            <label for="wardrobe-notes">Notes (Optional)</label>
                            <textarea name="notes" id="wardrobe-notes" class="form-control" rows="3" placeholder="Add any notes about this item..."></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-success">
                            <i class="fas fa-plus mr-2"></i> Add to Wardrobe
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    </div> <!-- container .//  -->
    </section>
    <!-- ========================= SECTION CONTENT END// ========================= -->
     {% endblock %}
