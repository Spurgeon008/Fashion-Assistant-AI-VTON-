{
  "nodes": [
    {
      "parameters": {
        "method": "POST",
        "url": "https://generativelanguage.googleapis.com/v1beta/models/veo-3.0-fast-generate-preview:predictLongRunning",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "key",
              "value": "AIzaSyBC7BfwnfQbdAQubKwbIEzsHklbWKmjtgs"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"instances\": [\n    {\n      \"prompt\": \"{{ $json.prompt }}\",\n      \"image\": {\n        \"bytesBase64Encoded\": \"{{ $json.image0 }}\",\n        \"mimeType\": \"image/png\"\n      }\n    }\n  ],\n  \"parameters\": {\n    \"aspectRatio\": \"16:9\"\n  }\n}\n",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        208,
        -1632
      ],
      "id": "cdd4c7c3-4b75-4230-ba46-dbdce1b9e61c",
      "name": "HTTP Request"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        400,
        -1632
      ],
      "id": "8ad0d7c6-190f-4208-b575-180791f9ddca",
      "name": "Wait",
      "webhookId": "e0f09e20-77e7-41a7-b38c-be3bbde32532"
    },
    {
      "parameters": {
        "operation": "create",
        "databaseId": 172,
        "tableId": 706,
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": 6869,
              "fieldValue": "={{ $('start').item.json.userid }}"
            },
            {
              "fieldId": 6870,
              "fieldValue": "={{ $('start').item.json.script }}"
            },
            {
              "fieldId": 6871,
              "fieldValue": "={{ $json.name }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.baserow",
      "typeVersion": 1,
      "position": [
        688,
        -1424
      ],
      "id": "ba6c251a-636a-49be-86a6-cd3295b9d8b6",
      "name": "Create a row1",
      "credentials": {
        "baserowApi": {
          "id": "BafUqBYezrcMUXZH",
          "name": "Baserow account 2"
        }
      }
    },
    {
      "parameters": {
        "url": "={{ $json.response.generateVideoResponse.generatedSamples[0].video.uri }}",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "key",
              "value": "AIzaSyDktTtX2nXl-QTBWuLmZho5fV3PzDS9d9A"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        400,
        -1424
      ],
      "id": "7314c355-3b8c-4301-baee-35094bbdf4a8",
      "name": "download"
    },
    {
      "parameters": {
        "url": "=https://generativelanguage.googleapis.com/v1beta/{{ $json.name }}",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "key",
              "value": "AIzaSyDktTtX2nXl-QTBWuLmZho5fV3PzDS9d9A"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        560,
        -1632
      ],
      "id": "6de1caba-6e36-4fcf-8b10-bd459605aab3",
      "name": "HTTP Request4"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "b70186bb-adee-4b8b-9479-948e1f962da1",
              "leftValue": "={{ $json.done }}",
              "rightValue": "true",
              "operator": {
                "type": "boolean",
                "operation": "exists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        688,
        -1632
      ],
      "id": "b0c61c1e-5612-4aac-a096-5f7ff78656dc",
      "name": "If2"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://host.docker.internal:85/api/user-files/upload-file/",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "contentType": "multipart-form-data",
        "bodyParameters": {
          "parameters": [
            {
              "parameterType": "formBinaryData",
              "name": "file",
              "inputDataFieldName": "data"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        544,
        -1424
      ],
      "id": "846e44a6-1555-4a05-a687-c13a5cfcc4f2",
      "name": "output2",
      "credentials": {
        "httpHeaderAuth": {
          "id": "c95uehxeKDKY8RwF",
          "name": "Header Auth account 2"
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        -352,
        -1616
      ],
      "id": "d4667d48-48b2-46f1-b71c-a77d922d466b",
      "name": "Merge4"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "f46f3bcb-4c61-40ce-8e97-42a89a695963",
              "leftValue": "={{ $json.output }}",
              "rightValue": "image-vid",
              "operator": {
                "type": "string",
                "operation": "contains"
              }
            },
            {
              "id": "b863394f-b6df-4220-be7d-e5d9908837f2",
              "leftValue": "={{ $json.image0 }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "exists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -32,
        -1616
      ],
      "id": "b5ae7a76-31be-4243-a134-bb1bf23e2ded",
      "name": "If3"
    },
    {
      "parameters": {
        "jsCode": "const inputs = $input.all();\n\nlet merged = {};\nfor (const item of inputs) {\n  merged = { ...merged, ...item.json };\n}\n\nreturn [{ json: merged }];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -192,
        -1616
      ],
      "id": "cfbb47e4-eeb7-4fd3-bff6-e5d74540b263",
      "name": "Code in JavaScript3"
    },
    {
      "parameters": {
        "jsCode": "// Get the first input item\nconst inputItem = $input.first();\n\n// Safely access binaries\nconst image0 = inputItem.binary?.image;\n\nreturn [\n  {\n    json: {\n      prompt: $input.first().json.body.prompt,\n      image0: image0 ? image0.data : null,\n      image0_mime: image0 ? image0.mimeType : null,\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -544,
        -1632
      ],
      "id": "3cb1b35f-09fa-484e-874a-7d6fe08e8692",
      "name": "Code"
    },
    {
      "parameters": {
        "content": "## image to video\n",
        "height": 400,
        "width": 1424,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -560,
        -1680
      ],
      "id": "e4db0e62-f12d-4dbb-8661-0ca51dc0df47",
      "name": "Sticky Note3"
    }
  ],
  "connections": {
    "HTTP Request": {
      "main": [
        [
          {
            "node": "Wait",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait": {
      "main": [
        [
          {
            "node": "HTTP Request4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create a row1": {
      "main": [
        []
      ]
    },
    "download": {
      "main": [
        [
          {
            "node": "output2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request4": {
      "main": [
        [
          {
            "node": "If2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If2": {
      "main": [
        [
          {
            "node": "download",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Wait",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "output2": {
      "main": [
        [
          {
            "node": "Create a row1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge4": {
      "main": [
        [
          {
            "node": "Code in JavaScript3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If3": {
      "main": [
        [
          {
            "node": "HTTP Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript3": {
      "main": [
        [
          {
            "node": "If3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code": {
      "main": [
        [
          {
            "node": "Merge4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "4b15e60afdd7fb8f887c260b52eaec04bd1b8e1e829a506481a80c41dc231bb0"
  }
}